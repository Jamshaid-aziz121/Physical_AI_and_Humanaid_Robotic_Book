name: Continuous Integration

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install ROS 2 Humble
      run: |
        sudo apt update
        sudo apt install -y software-properties-common
        sudo add-apt-repository universe
        sudo apt update
        sudo apt install -y curl gnupg lsb-release
        sudo curl -sSL https://raw.githubusercontent.com/ros/rosdistro/master/ros.key -o /usr/share/keyrings/ros-archive-keyring.gpg
        echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/ros-archive-keyring.gpg] http://packages.ros.org/ros2/ubuntu $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/ros2.list > /dev/null
        sudo apt update
        

    - name: Install Python dependencies
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt || echo "No requirements.txt found"

    - name: Check code examples exist
      run: |
        if [ ! -d "book-content/modules/01-ros2-fundamentals/code-examples" ]; then
          echo "ROS 2 examples directory not found!"
          exit 1
        fi

    - name: Validate URDF files
      run: |
        if command -v gz &> /dev/null; then
          echo "Gazebo installed, checking URDF files..."
          find simulation-assets/urdf -name "*.urdf" -exec check_urdf {} \; || echo "URDF validation skipped"
        else
          echo "Gazebo not available, skipping URDF validation"
        fi

    - name: Run basic tests
      run: |
        echo "Running basic validation tests..."
        python -m py_compile book-content/modules/common_utils/robot_utils.py
        echo "Python syntax validation passed"

    - name: Run Print Path
      run: |
        echo "current working directory"
        ls

    - name: Validate Docusaurus site
      run: |
        cd physical-ai-humanoid-book
        if [ -f "package.json" ]; then
          npm ci
          npm run build
        else
          echo "Docusaurus site not found, skipping validation"
        fi